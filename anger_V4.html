<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‚¸æ‰åå¿ƒæƒ… - æç®€ç‰ˆ</title>
    <style>
        /* å…¨å±€æç®€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "å¾®è½¯é›…é»‘", "PingFang SC", sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
            transition: background-color 0.3s;
        }

        /* çˆ†ç‚¸éœ‡åŠ¨æ•ˆæœ */
        body.shake {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-5px); }
            40% { transform: translateX(5px); }
            60% { transform: translateX(-3px); }
            80% { transform: translateX(3px); }
        }

        /* é¡¶éƒ¨å¯¼èˆªï¼ˆæç®€ï¼‰ */
        .tab-nav {
            display: flex;
            background: linear-gradient(135deg, #e53e3e 0%, #ed8936 100%);
            color: white;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(229, 62, 62, 0.2);
        }

        .tab-item {
            flex: 1;
            text-align: center;
            padding: 16px 0;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background-color 0.2s;
        }

        .tab-item.active {
            background-color: rgba(255, 255, 255, 0.2);
        }

        /* å†…å®¹åŒºåŸŸ */
        .content {
            margin-top: 65px;
            padding: 20px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* çˆ†ç‚¸é¡µé¢æ ¸å¿ƒæ ·å¼ */
        .explode-box {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
        }

        .hint-text {
            font-size: 15px;
            color: #e53e3e;
            margin-bottom: 20px;
            text-align: center;
            line-height: 1.5;
        }

        /* å•ä¸€è¾“å…¥æ¡† */
        #bad-mood-content {
            width: 100%;
            padding: 16px;
            border: 1px solid #fcd5d5;
            border-radius: 8px;
            font-size: 16px;
            min-height: 200px;
            resize: vertical;
            background-color: #fff8f8;
            transition: border-color 0.2s, box-shadow 0.2s;
            margin-bottom: 20px;
            z-index: 10;
            position: relative;
        }

        #bad-mood-content:focus {
            outline: none;
            border-color: #e53e3e;
            box-shadow: 0 0 0 2px rgba(229, 62, 62, 0.1);
        }

        /* ç‚¸å¼¹æŒ‰é’®ï¼ˆæ ¸å¿ƒäº¤äº’ï¼‰ */
        .explode-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #e53e3e 0%, #ed8936 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            z-index: 10;
            position: relative;
        }

        .explode-btn:hover {
            background: linear-gradient(135deg, #d32f2f 0%, #f57c00 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(229, 62, 62, 0.2);
        }

        .explode-btn:active {
            transform: scale(0.98);
        }

        .explode-btn:disabled {
            background: #f5c6c6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* çˆ†ç‚¸ç‰¹æ•ˆå®¹å™¨ */
        .explosion-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
            display: none;
        }

        /* çˆ†ç‚¸ç¢ç‰‡ */
        .explosion-piece {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: #ed8936;
            opacity: 0.8;
            animation: explode 0.6s ease-out forwards;
        }

        @keyframes explode {
            0% {
                opacity: 1;
                transform: scale(0);
                top: 50%;
                left: 50%;
            }
            50% {
                opacity: 1;
                transform: scale(1.2);
            }
            100% {
                opacity: 0;
                transform: scale(0.5) translate(var(--x), var(--y));
            }
        }

        /* å†å²è®°å½•ï¼ˆæç®€ï¼‰ */
        .history-empty {
            text-align: center;
            padding: 60px 20px;
            color: #999;
            font-size: 16px;
        }

        .date-group {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            margin-bottom: 15px;
        }

        .date-header {
            padding: 14px 18px;
            background: #fff8f8;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 16px;
            font-weight: 500;
            color: #d32f2f;
        }

        .count-badge {
            background-color: #e53e3e;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 13px;
        }

        .records-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .records-container.expanded {
            max-height: 2000px;
        }

        .record-item {
            padding: 16px 18px;
            border-bottom: 1px solid #fef2f2;
            position: relative;
            font-size: 15px;
            color: #333;
            white-space: pre-wrap;
        }

        .record-item:last-child {
            border-bottom: none;
        }

        .record-time {
            font-size: 12px;
            color: #999;
            margin-bottom: 8px;
        }

        /* åˆ é™¤æŒ‰é’® */
        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #fff0f0;
            color: #e53e3e;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 12px;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .record-item:hover .delete-btn {
            opacity: 1;
        }

        /* æ¸…ç©ºå…¨éƒ¨æŒ‰é’® */
        .clear-all-btn {
            width: 100%;
            padding: 12px;
            background: transparent;
            color: #e53e3e;
            border: 1px solid #fcd5d5;
            border-radius: 8px;
            font-size: 15px;
            cursor: pointer;
            margin-bottom: 20px;
            transition: background-color 0.2s;
        }

        .clear-all-btn:hover {
            background-color: #fff0f0;
        }

        /* æç¤ºæ¡† */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(229, 62, 62, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 999;
        }

        .toast.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <div class="tab-nav">
        <div class="tab-item active" onclick="switchTab('explode')">ç‚¸æ‰åå¿ƒæƒ…</div>
        <div class="tab-item" onclick="switchTab('history')">å†å²è®°å½•</div>
    </div>

    <!-- å†…å®¹åŒºåŸŸ -->
    <div class="content">
        <!-- çˆ†ç‚¸é¡µé¢ -->
        <div id="explode-tab" class="tab-content active">
            <div class="explode-box">
                <!-- çˆ†ç‚¸ç‰¹æ•ˆå®¹å™¨ -->
                <div class="explosion-container" id="explosion-container"></div>
                
                <p class="hint-text">æŠŠæ‰€æœ‰æ„¤æ€’ã€ä¸æ»¡éƒ½å†™ä¸‹æ¥<br>ç‚¹å‡»ç‚¸å¼¹ï¼Œç‚¸æ‰æ‰€æœ‰åå¿ƒæƒ…ï¼</p>
                
                <textarea 
                    id="bad-mood-content" 
                    placeholder="æ¯”å¦‚ï¼šè®¨åŒçš„è€æ¿å¤ªè¿‡åˆ†äº†ï¼æ¯å¤©åŠ ç­è¿˜ä¸æ¶¨å·¥èµ„ï¼ŒçœŸçš„æ°”æ­»æˆ‘äº†..."
                    oninput="checkInput()">
                </textarea>

                <button class="explode-btn" id="explode-btn" disabled onclick="explodeBadMood()">
                    ğŸ’£ ç‚¸æ‰åå¿ƒæƒ…
                </button>
            </div>
        </div>

        <!-- å†å²è®°å½•é¡µé¢ -->
        <div id="history-tab" class="tab-content">
            <button class="clear-all-btn" onclick="clearAllRecords()" id="clear-all-btn" style="display: none;">
                æ¸…ç©ºå…¨éƒ¨è®°å½•
            </button>
            <div id="history-list">
                <div class="history-empty">
                    æš‚æ— åå¿ƒæƒ…è®°å½•<br>å¿«å»ç‚¸æ‰ä½ çš„ç¬¬ä¸€ä¸ªçƒ¦æ¼å§
                </div>
            </div>
        </div>
    </div>

    <!-- æç¤ºæ¡† -->
    <div id="toast" class="toast"></div>

    <script>
        const RECORD_KEY = 'bad_mood_records';

        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            document.querySelectorAll('.tab-item').forEach(item => item.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(item => item.classList.remove('active'));
            document.getElementById(`${tabName}-tab`).classList.add('active');

            if (tabName === 'history') renderHistoryList();
        }

        // æ£€æŸ¥è¾“å…¥å†…å®¹ï¼Œå¯ç”¨/ç¦ç”¨ç‚¸å¼¹æŒ‰é’®
        function checkInput() {
            const content = document.getElementById('bad-mood-content').value.trim();
            const explodeBtn = document.getElementById('explode-btn');
            explodeBtn.disabled = content.length === 0;
        }

        // ç”Ÿæˆçˆ†ç‚¸ç¢ç‰‡
        function createExplosion() {
            const container = document.getElementById('explosion-container');
            container.style.display = 'block';
            container.innerHTML = ''; // æ¸…ç©ºä¹‹å‰çš„ç¢ç‰‡

            // ç”Ÿæˆ20ä¸ªçˆ†ç‚¸ç¢ç‰‡
            for (let i = 0; i < 20; i++) {
                const piece = document.createElement('div');
                piece.className = 'explosion-piece';
                
                // éšæœºç¢ç‰‡æ–¹å‘å’Œå¤§å°
                const angle = Math.random() * Math.PI * 2;
                const distance = 50 + Math.random() * 100;
                const x = Math.cos(angle) * distance;
                const y = Math.sin(angle) * distance;
                
                piece.style.setProperty('--x', `${x}px`);
                piece.style.setProperty('--y', `${y}px`);
                piece.style.backgroundColor = `rgb(${229 + Math.random()*20}, ${62 + Math.random()*30}, ${36 + Math.random()*20})`;
                
                container.appendChild(piece);
            }

            // é¡µé¢éœ‡åŠ¨
            document.body.classList.add('shake');
            setTimeout(() => {
                document.body.classList.remove('shake');
                container.style.display = 'none';
            }, 600);
        }

        // ç‚¸æ‰åå¿ƒæƒ…æ ¸å¿ƒé€»è¾‘
        function explodeBadMood() {
            const content = document.getElementById('bad-mood-content').value.trim();
            
            // åˆ›å»ºè®°å½•
            const record = {
                id: Date.now().toString(),
                content: content,
                time: new Date().toISOString()
            };

            // å­˜å‚¨è®°å½•
            let records = JSON.parse(localStorage.getItem(RECORD_KEY) || '[]');
            records.push(record);
            localStorage.setItem(RECORD_KEY, JSON.stringify(records));

            // è§¦å‘çˆ†ç‚¸ç‰¹æ•ˆ
            createExplosion();

            // æ¸…ç©ºè¾“å…¥æ¡† + ç¦ç”¨æŒ‰é’®
            document.getElementById('bad-mood-content').value = '';
            document.getElementById('explode-btn').disabled = true;

            // æç¤ºæˆåŠŸ
            showToast('åå¿ƒæƒ…å·²ç‚¸é£ï¼å¿ƒæƒ…èˆ’ç•…å•¦ âœ¨');
        }

        // æŒ‰æ—¥æœŸåˆ†ç»„
        function groupRecordsByDate(records) {
            const groups = {};
            records.forEach(record => {
                const date = new Date(record.time).toISOString().split('T')[0];
                if (!groups[date]) groups[date] = [];
                groups[date].push(record);
            });
            return Object.keys(groups).sort((a, b) => new Date(b) - new Date(a)).map(date => ({
                date: date,
                records: groups[date]
            }));
        }

        // æ¸²æŸ“å†å²è®°å½•
        function renderHistoryList() {
            const historyList = document.getElementById('history-list');
            const clearAllBtn = document.getElementById('clear-all-btn');
            let records = JSON.parse(localStorage.getItem(RECORD_KEY) || '[]');

            if (records.length === 0) {
                historyList.innerHTML = `<div class="history-empty">æš‚æ— åå¿ƒæƒ…è®°å½•<br>å¿«å»ç‚¸æ‰ä½ çš„ç¬¬ä¸€ä¸ªçƒ¦æ¼å§</div>`;
                clearAllBtn.style.display = 'none';
                return;
            }

            clearAllBtn.style.display = 'block';
            
            records.sort((a, b) => new Date(b.time) - new Date(a.time));
            const groupedRecords = groupRecordsByDate(records);

            let html = '';
            groupedRecords.forEach(group => {
                const dateText = formatDate(group.date);
                html += `
                    <div class="date-group">
                        <div class="date-header" onclick="toggleRecords('${group.date}')">
                            <div>${dateText}</div>
                            <div class="count-badge">${group.records.length} æ¡çƒ¦æ¼</div>
                        </div>
                        <div id="records-${group.date}" class="records-container">
                `;

                group.records.forEach(record => {
                    const time = new Date(record.time).toLocaleTimeString('zh-CN', {
                        hour: '2-digit',
                        minute: '2-digit',
                        hour12: false
                    });
                    
                    html += `
                        <div class="record-item">
                            <button class="delete-btn" onclick="deleteRecord('${record.id}')">åˆ é™¤</button>
                            <div class="record-time">${time}</div>
                            <div>${record.content}</div>
                        </div>
                    `;
                });

                html += `</div></div>`;
            });

            historyList.innerHTML = html;
        }

        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return `${date.getFullYear()}å¹´${date.getMonth()+1}æœˆ${date.getDate()}æ—¥`;
        }

        // å±•å¼€/æ”¶èµ·è®°å½•
        function toggleRecords(date) {
            document.getElementById(`records-${date}`).classList.toggle('expanded');
        }

        // åˆ é™¤å•æ¡è®°å½•
        function deleteRecord(recordId) {
            if (!confirm('ç¡®å®šåˆ é™¤è¿™æ¡çƒ¦æ¼è®°å½•ï¼Ÿ')) return;
            
            let records = JSON.parse(localStorage.getItem(RECORD_KEY) || '[]');
            records = records.filter(record => record.id !== recordId);
            localStorage.setItem(RECORD_KEY, JSON.stringify(records));
            
            renderHistoryList();
            showToast('çƒ¦æ¼è®°å½•å·²åˆ é™¤');
        }

        // æ¸…ç©ºå…¨éƒ¨è®°å½•
        function clearAllRecords() {
            if (!confirm('ç¡®å®šæ¸…ç©ºæ‰€æœ‰çƒ¦æ¼è®°å½•ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ï¼')) return;
            
            localStorage.removeItem(RECORD_KEY);
            renderHistoryList();
            showToast('æ‰€æœ‰çƒ¦æ¼éƒ½æ¸…ç©ºå•¦');
        }

        // æç¤ºæ¡†
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2500);
        }

        // åˆå§‹åŒ–
        window.onload = () => {
            renderHistoryList();
            checkInput();
        };
    </script>
</body>
</html>